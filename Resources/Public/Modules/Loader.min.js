function T(e,{bubbles:t=!0,cancelable:n=!0,composed:s=!0}={},a=document){a.dispatchEvent(new Event(e,{bubbles:t,cancelable:n,composed:s}))}var B=document.head,L={},w="data-loader",C=e=>!(e===void 0||e==="false");function Y({callback:e=()=>{},callbackMode:t="always",rootElement:n=document,markup:s=""}={}){if(s){if(!s.includes(` ${w}`)){e();return}n=document.createRange().createContextualFragment(`<template>${s}</template>`).firstElementChild.content}let a=U(n);if(a.length===0){t==="always"&&e();return}let o=[],i=[],r=[],u=!1;a.forEach(O=>{let c=O.dataset,p=!C(c.noCache),m=C(c.debug),v=c.css,j=c.js,D=c.mjs,y=c.split||",",A=c.eventOnLoad;r.push(A);let f=c.loader||!1;f!=="async"&&f!=="defer"&&(f=!1);let E=v?S(y,v,"css",p,m):!1,g=D?S(y,D,"mjs",p,m,f):!1,h=j?S(y,j,"js",p,m,f):!1;E&&(i=[...i,...E]),g&&(o=[...o,...g]),h&&(o=[...o,...h]),m&&(u=!0,console.log("LOADER: element setting",{styles:E,modules:g,scripts:h,eventOnLoad:A}))}),r=[...new Set(r)].filter(Boolean);let l=$(i),d=$(o);return u&&console.log("LOADER: all settings",{styles:l,scripts:d,eventsOnLoad:r}),q(l).then(()=>{(!d.length&&t==="always"||t==="newCSS")&&(H(r),e())}),q(d).then(()=>{(t==="always"||t==="newJS")&&(H(r),e())}),{styles:l,scripts:d}}function q(e){return e instanceof Array?Promise.all(e.map(x)):x(e)}function S(e,t,n,s=!0,a=!1,o=!1){return t.split(e).map(i=>({url:i,type:n,useCache:s,debug:a,scriptExecution:o}))}function x({url:e,type:t,useCache:n,debug:s,scriptExecution:a}){if(!e)throw new Error("LOADER: You must provide a url to load");let o=L[e];if(o&&n)return s&&console.log("LOADER: cache hit",e),o;{let u=t==="css"?M(e):F(e);if(u){let l=Promise.resolve(u);return n&&(L[e]=l),l}}let i=t==="css"?b({url:e}):P({url:e,type:t,scriptExecution:a}),r=R(i);return n&&(L[e]=r),r}function R(e){return new Promise(function(t,n){let s=!1;e.onload=e.onreadystatechange=function(){!s&&(!e.readyState||e.readyState==="loaded"||e.readyState==="complete")&&(s=!0,e.onload=e.onreadystatechange=null,t(e))},e.onerror=n,B.appendChild(e)})}function F(e){return document.querySelector(`script[src="${e}"]`)}function M(e){return document.querySelector(`link[href="${e}"]`)}function b({url:e}){if(!e)return;let t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function P({url:e,type:t,scriptExecution:n}){if(!e)return;let s=document.createElement("script");return t==="mjs"&&(s.type="module"),n&&(s[n]=!0),s.src=e,s}function U(e){let t=[...e.querySelectorAll(`[${w}]`)];return[...e.querySelectorAll("template")].forEach(s=>{t=[...t,...s.content.querySelectorAll(`[${w}]`)]}),t}function H(e){e.forEach(t=>{T(t)})}function $(e){let t=[];return e.filter(n=>t.includes(n.url)?!1:(t.push(n.url),!0))}export{q as Loader,S as LoaderMap,Y as default,Y as initLoader};
