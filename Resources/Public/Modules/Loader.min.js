function C(e,{bubbles:t=!0,cancelable:n=!0,composed:s=!0}={},a=document){a.dispatchEvent(new Event(e,{bubbles:t,cancelable:n,composed:s}))}var R=document.head,L={},w="data-loader",q=e=>!(e===void 0||e==="false");function z({callback:e=()=>{},callbackMode:t="always",rootElement:n=document,markup:s=""}={}){if(s){if(!s.includes(` ${w}`)){e();return}n=document.createRange().createContextualFragment(`<template>${s}</template>`).firstElementChild.content}let a=J(n);if(a.length===0){t==="always"&&e();return}let o=[],i=[],r=[],u=!1;a.forEach(O=>{let c=O.dataset,m=!q(c.noCache),p=q(c.debug),v=c.css,j=c.js,A=c.mjs,y=c.split||",",D=c.eventOnLoad;r.push(D);let f=c.loader||!1;f!=="async"&&f!=="defer"&&(f=!1);let h=v?S(y,v,"css",m,p):!1,E=A?S(y,A,"mjs",m,p,f):!1,g=j?S(y,j,"js",m,p,f):!1;h&&(i=[...i,...h]),E&&(o=[...o,...E]),g&&(o=[...o,...g]),p&&(u=!0,console.log("LOADER: element setting",{styles:h,modules:E,scripts:g,eventOnLoad:D}))}),r=[...new Set(r)].filter(Boolean);let l=B(i),d=B(o);return u&&console.log("LOADER: all settings",{styles:l,scripts:d,eventsOnLoad:r}),x(l).then(()=>{(!d.length&&t==="always"||t==="newCSS")&&($(r),e())}),x(d).then(()=>{(t==="always"||t==="newJS")&&($(r),e())}),{styles:l,scripts:d}}function x(e){return e instanceof Array?Promise.all(e.map(T)):T(e)}function S(e,t,n,s=!0,a=!1,o=!1){return t.split(e).map(i=>({url:i,type:n,useCache:s,debug:a,scriptExecution:o}))}function T({url:e,type:t,useCache:n,debug:s,scriptExecution:a}){if(!e)throw new Error("LOADER: You must provide a url to load");let o=L[e];if(o&&n)return s&&console.log("LOADER: cache hit",e),o;{let u=t==="css"?F(e):b(e);if(u){let l=Promise.resolve(u);return n&&(L[e]=l),l}}let i=t==="css"?P({url:e}):U({url:e,type:t,scriptExecution:a}),r=H(i);return n&&(L[e]=r),r}function H(e){return new Promise(function(t,n){let s=!1;e.onload=e.onreadystatechange=function(){!s&&(!e.readyState||e.readyState==="loaded"||e.readyState==="complete")&&(s=!0,e.onload=e.onreadystatechange=null,t(e))},e.onerror=n,R.appendChild(e)})}function b(e){return document.querySelector(`script[src="${e}"]`)}function F(e){return document.querySelector(`link[href="${e}"]`)}function P({url:e}){if(!e)return;let t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function U({url:e,type:t,scriptExecution:n}){if(!e)return;let s=document.createElement("script");return t==="mjs"&&(s.type="module"),n&&(s[n]=!0),s.src=e,s}function J(e){let t=[...e.querySelectorAll(`[${w}]`)];return[...e.querySelectorAll("template")].forEach(s=>{t=[...t,...s.content.querySelectorAll(`[${w}]`)]}),t}function $(e){e.forEach(t=>{C(t)})}function B(e){let t=[];return e.filter(n=>t.includes(n.url)?!1:(t.push(n.url),!0))}export{x as Loader,S as LoaderMap,z as default,z as initLoader};
