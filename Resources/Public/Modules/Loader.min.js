var B=document.head,E={},O="data-loader",q=e=>!(e===void 0||e==="false");function J({callback:e=()=>{},callbackMode:t="always",rootElement:n=document,markup:s=""}={}){if(s){if(!s.includes(` ${O}`)){e();return}n=document.createRange().createContextualFragment(`<template>${s}</template>`).firstElementChild.content}let i=U(n);if(i.length===0){t==="always"&&e();return}let o=[],c=[],r=[],f=!1;i.forEach(w=>{let a=w.dataset,m=!q(a.noCache),p=q(a.debug),j=a.css,A=a.js,D=a.mjs,y=a.split||",",v=a.eventOnLoad;r.push(v);let u=a.loader||!1;u!=="async"&&u!=="defer"&&(u=!1);let h=j?S(y,j,"css",m,p):!1,g=D?S(y,D,"mjs",m,p,u):!1,L=A?S(y,A,"js",m,p,u):!1;h&&(c=[...c,...h]),g&&(o=[...o,...g]),L&&(o=[...o,...L]),p&&(f=!0,console.log("LOADER: element setting",{styles:h,modules:g,scripts:L,eventOnLoad:v}))}),r=[...new Set(r)].filter(Boolean);let l=x(c),d=x(o);return f&&console.log("LOADER: all settings",{styles:l,scripts:d,eventsOnLoad:r}),C(l).then(()=>{(!d.length&&t==="always"||t==="newCSS")&&($(r),e())}),C(d).then(()=>{(t==="always"||t==="newJS")&&($(r),e())}),{styles:l,scripts:d}}function C(e){return e instanceof Array?Promise.all(e.map(T)):T(e)}function S(e,t,n,s=!0,i=!1,o=!1){return t.split(e).map(c=>({url:c,type:n,useCache:s,debug:i,scriptExecution:o}))}function T({url:e,type:t,useCache:n,debug:s,scriptExecution:i}){if(!e)throw new Error("LOADER: You must provide a url to load");let o=E[e];if(o&&n)return s&&console.log("LOADER: cache hit",e),o;{let f=t==="css"?b(e):H(e);if(f){let l=Promise.resolve(f);return n&&(E[e]=l),l}}let c=t==="css"?F({url:e}):P({url:e,type:t,scriptExecution:i}),r=R(c);return n&&(E[e]=r),r}function R(e){return new Promise(function(t,n){let s=!1;e.onload=e.onreadystatechange=function(){!s&&(!e.readyState||e.readyState==="loaded"||e.readyState==="complete")&&(s=!0,e.onload=e.onreadystatechange=null,t(e))},e.onerror=n,B.appendChild(e)})}function H(e){return document.querySelector(`script[src="${e}"]`)}function b(e){return document.querySelector(`link[href="${e}"]`)}function F({url:e}){if(!e)return;let t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function P({url:e,type:t,scriptExecution:n}){if(!e)return;let s=document.createElement("script");return t==="mjs"&&(s.type="module"),n&&(s[n]=!0),s.src=e,s}function U(e){let t=[...e.querySelectorAll(`[${O}]`)];return[...e.querySelectorAll("template")].forEach(s=>{t=[...t,...s.content.querySelectorAll(`[${O}]`)]}),t}function $(e){e.forEach(t=>{document.dispatchEvent(new Event(t))})}function x(e){let t=[];return e.filter(n=>t.includes(n.url)?!1:(t.push(n.url),!0))}export{C as Loader,S as LoaderMap,J as default,J as initLoader};
