var x=document.head,E={},O="data-loader",v=e=>!(e===void 0||e==="false");function J({callback:e=()=>{},callbackMode:t="always",rootElement:n=document,markup:s=""}={}){if(s){if(!s.includes(` ${O}`)){e();return}n=document.createRange().createContextualFragment(`<template>${s}</template>`).firstElementChild.content}let l=U(n);if(l.length===0){t==="always"&&e();return}let o=[],c=[],r=[],u=!1;l.forEach(w=>{let a=w.dataset,m=!v(a.noCache),p=v(a.debug),j=a.css,A=a.js,D=a.mjs,y=a.split||",",b=a.eventOnLoad;r.push(b);let f=a.loader||!1;f!=="async"&&f!=="defer"&&(f=!1);let h=j?S(y,j,"css",m,p):!1,g=D?S(y,D,"mjs",m,p,f):!1,L=A?S(y,A,"js",m,p,f):!1;h&&(c=[...c,...h]),g&&(o=[...o,...g]),L&&(o=[...o,...L]),p&&(u=!0,console.log("LOADER: element setting",{styles:h,modules:g,scripts:L,eventOnLoad:b}))}),r=[...new Set(r)].filter(Boolean);let i=$(c),d=$(o);return u&&console.log("LOADER: all settings",{styles:i,scripts:d,eventsOnLoad:r}),q(i).then(()=>{(!d.length&&t==="always"||t==="newCSS")&&(T(r),e())}),q(d).then(()=>{(t==="always"||t==="newJS")&&(T(r),e())}),{styles:i,scripts:d}}function q(e){return e instanceof Array?Promise.all(e.map(C)):C(e)}function S(e,t,n,s=!0,l=!1,o=!1){return t.split(e).map(c=>({url:c,type:n,useCache:s,debug:l,scriptExecution:o}))}function C({url:e,type:t,useCache:n,debug:s,scriptExecution:l}){if(!e)throw new Error("LOADER: You must provide a url to load");let o=E[e];if(o&&n)return s&&console.log("LOADER: cache hit",e),o;{let u=t==="css"?H(e):R(e);if(u){let i=Promise.resolve(u);return n&&(E[e]=i),i}}let c=t==="css"?F({url:e}):P({url:e,type:t,scriptExecution:l}),r=B(c);return n&&(E[e]=r),r}function B(e){return new Promise(function(t,n){let s=!1;e.onload=e.onreadystatechange=function(){!s&&(!e.readyState||e.readyState==="loaded"||e.readyState==="complete")&&(s=!0,e.onload=e.onreadystatechange=null,t(e))},e.onerror=n,x.appendChild(e)})}function R(e){return document.querySelector(`script[src="${e}"]`)}function H(e){return document.querySelector(`link[href="${e}"]`)}function F({url:e}){if(!e)return;let t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function P({url:e,type:t,scriptExecution:n}){if(!e)return;let s=document.createElement("script");return t==="mjs"&&(s.type="module"),n&&(s[n]=!0),s.src=e,s}function U(e){let t=[...e.querySelectorAll(`[${O}]`)];return[...e.querySelectorAll("template")].forEach(s=>{t=[...t,...s.content.querySelectorAll(`[${O}]`)]}),t}function T(e){e.forEach(t=>{document.dispatchEvent(new Event(t,{bubbles:!0,cancelable:!0,composed:!0}))})}function $(e){let t=[];return e.filter(n=>t.includes(n.url)?!1:(t.push(n.url),!0))}export{q as Loader,S as LoaderMap,J as default,J as initLoader};
