var g=document.head,f={},p="data-loader",m=e=>!(e===void 0||e==="false");function x({callback:e=()=>{},rootElement:t=document,markup:o=""}={}){if(o){if(!o.includes(` ${p}`)){e();return}t=document.createRange().createContextualFragment(`<template>${o}</template>`).firstElementChild.content}let n=A(t);if(n.length===0){e();return}let r=[],a=[];return n.forEach(d=>{let s=d.dataset,c=!m(s.noCache),i=m(s.debug),l=s.scriptExecution||!1;l!=="async"&&l!=="defer"&&(l=!1),s?.css&&(a=[...a,...u(s.css,"css",c,i)]),s?.mjs&&(r=[...r,...u(s.mjs,"mjs",c,i,l)]),s?.js&&(r=[...r,...u(s.js,"js",c,i,l)])}),a=[...new Set(a)],r=[...new Set(r)],y(a).then(()=>{r.length||e()}),y(r).then(e),{styles:a,scripts:r}}function y(e){return e instanceof Array?Promise.all(e.map(h)):h(e)}function u(e,t,o=!0,n=!1,r=!1){return e.split(",").map(a=>({url:a,type:t,useCache:o,debug:n,scriptExecution:r}))}function h({url:e,type:t,useCache:o,debug:n,scriptExecution:r}){if(!e)throw new Error("LOADER: You must provide a url to load");let a=f[e];if(a&&o)return n&&console.log("LOADER: cache hit",e),a;{let c=t==="css"?S(e):E(e);if(c){let i=Promise.resolve(c);return o&&(f[e]=i),i}}let d=t==="css"?j({url:e}):O({url:e,type:t,scriptExecution:r}),s=L(d);return o&&(f[e]=s),s}function L(e){return new Promise(function(t,o){let n=!1;e.onload=e.onreadystatechange=function(){!n&&(!e.readyState||e.readyState==="loaded"||e.readyState==="complete")&&(n=!0,e.onload=e.onreadystatechange=null,t(e))},e.onerror=o,g.appendChild(e)})}function E(e){return document.querySelector(`script[src="${e}"]`)}function S(e){return document.querySelector(`link[href="${e}"]`)}function j({url:e}){if(!e)return;let t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function O({url:e,type:t,scriptExecution:o}){if(!e)return;let n=document.createElement("script");return t==="mjs"&&(n.type="module"),o&&(n[o]=!0),n.src=e,n}function A(e){let t=[...e.querySelectorAll(`[${p}]`)];return[...e.querySelectorAll("template")].forEach(n=>{t=[...t,...n.content.querySelectorAll(`[${p}]`)]}),t}export{y as Loader,u as LoaderMap,x as default,x as initLoader};
