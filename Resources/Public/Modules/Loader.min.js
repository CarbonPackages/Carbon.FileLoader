var g=document.head,l={},m="data-loader",p=e=>!(e===void 0||e==="false");function x({callback:e=()=>{},rootElement:t=document,markup:o=""}={}){if(o){if(!o.includes(` ${m}`)){e();return}t=document.createRange().createContextualFragment(`<template>${o}</template>`).firstElementChild.content}let n=[...t.querySelectorAll(`[${m}]`)];if(!o&&n.length===0){e();return}let r=[],a=[];return n.forEach(f=>{let s=f.dataset,c=!p(s.noCache),i=p(s.debug),d=s.scriptExecution||!1;d!=="async"&&d!=="defer"&&(d=!1),s?.css&&(a=[...a,...u(s.css,"css",c,i)]),s?.mjs&&(r=[...r,...u(s.mjs,"mjs",c,i,d)]),s?.js&&(r=[...r,...u(s.js,"js",c,i,d)])}),a=[...new Set(a)],r=[...new Set(r)],h(a).then(()=>{r.length||e()}),h(r).then(e),{styles:a,scripts:r}}function h(e){return e instanceof Array?Promise.all(e.map(y)):y(e)}function u(e,t,o=!0,n=!1,r=!1){return e.split(",").map(a=>({url:a,type:t,useCache:o,debug:n,scriptExecution:r}))}function y({url:e,type:t,useCache:o,debug:n,scriptExecution:r}){if(!e)throw new Error("LOADER: You must provide a url to load");let a=l[e];if(a)return n&&console.log("LOADER: cache hit",e),a;{let c=t==="css"?j(e):S(e);if(c){let i=Promise.resolve(c);return e&&(l[e]=i),i}}let f=t==="css"?O({url:e}):T({url:e,type:t,scriptExecution:r}),s=E(f);return o&&(l[e]=s),s}function E(e){return new Promise(function(t,o){let n=!1;e.onload=e.onreadystatechange=function(){!n&&(!e.readyState||e.readyState==="loaded"||e.readyState==="complete")&&(n=!0,e.onload=e.onreadystatechange=null,t(e))},e.onerror=o,g.appendChild(e)})}function S(e){return L(e&&document.querySelector(`script[src='${e}']`))}function j(e){return L(e&&document.querySelector(`link[href='${e}']`))}function L(e){if(e&&e.dataset.marker!=="true")return e}function O({url:e}){if(!e)return;let t=document.createElement("link");return t.rel="stylesheet",t.href=e,t.dataset.marker="true",t}function T({url:e,type:t,scriptExecution:o}){if(!e)return;let n=document.createElement("script");return t==="mjs"&&(n.type="module"),o&&(n[o]=!0),n.dataset.marker="true",n.src=e,n}export{h as Loader,u as LoaderMap,x as default,x as initLoader};
