var x=document.head,L={},S="data-loader",v=e=>!(e===void 0||e==="false");function U({callback:e=()=>{},callbackMode:t="always",rootElement:n=document,markup:s=""}={}){if(s){if(!s.includes(` ${S}`)){e();return}n=document.createRange().createContextualFragment(`<template>${s}</template>`).firstElementChild.content}let c=P(n);if(c.length===0){t==="always"&&e();return}let o=[],i=[],r=[],f=!1;c.forEach(O=>{let a=O.dataset,m=!v(a.noCache),p=v(a.debug),w=a.css,j=a.js,A=a.mjs,D=a.eventOnLoad;r.push(D);let u=a.loader||!1;u!=="async"&&u!=="defer"&&(u=!1);let y=w?E(w,"css",m,p):!1,h=A?E(A,"mjs",m,p,u):!1,g=j?E(j,"js",m,p,u):!1;y&&(i=[...i,...y]),h&&(o=[...o,...h]),g&&(o=[...o,...g]),p&&(f=!0,console.log("LOADER: element setting",{styles:y,modules:h,scripts:g,eventOnLoad:D}))}),r=[...new Set(r)].filter(Boolean);let l=$(i),d=$(o);return f&&console.log("LOADER: all settings",{styles:l,scripts:d,eventsOnLoad:r}),q(l).then(()=>{(!d.length&&t==="always"||t==="newCSS")&&(T(r),e())}),q(d).then(()=>{(t==="always"||t==="newJS")&&(T(r),e())}),{styles:l,scripts:d}}function q(e){return e instanceof Array?Promise.all(e.map(C)):C(e)}function E(e,t,n=!0,s=!1,c=!1){return e.split(",").map(o=>({url:o,type:t,useCache:n,debug:s,scriptExecution:c}))}function C({url:e,type:t,useCache:n,debug:s,scriptExecution:c}){if(!e)throw new Error("LOADER: You must provide a url to load");let o=L[e];if(o&&n)return s&&console.log("LOADER: cache hit",e),o;{let f=t==="css"?H(e):R(e);if(f){let l=Promise.resolve(f);return n&&(L[e]=l),l}}let i=t==="css"?b({url:e}):F({url:e,type:t,scriptExecution:c}),r=B(i);return n&&(L[e]=r),r}function B(e){return new Promise(function(t,n){let s=!1;e.onload=e.onreadystatechange=function(){!s&&(!e.readyState||e.readyState==="loaded"||e.readyState==="complete")&&(s=!0,e.onload=e.onreadystatechange=null,t(e))},e.onerror=n,x.appendChild(e)})}function R(e){return document.querySelector(`script[src="${e}"]`)}function H(e){return document.querySelector(`link[href="${e}"]`)}function b({url:e}){if(!e)return;let t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function F({url:e,type:t,scriptExecution:n}){if(!e)return;let s=document.createElement("script");return t==="mjs"&&(s.type="module"),n&&(s[n]=!0),s.src=e,s}function P(e){let t=[...e.querySelectorAll(`[${S}]`)];return[...e.querySelectorAll("template")].forEach(s=>{t=[...t,...s.content.querySelectorAll(`[${S}]`)]}),t}function T(e){e.forEach(t=>{document.dispatchEvent(new Event(t))})}function $(e){let t=[];return e.filter(n=>t.includes(n.url)?!1:(t.push(n.url),!0))}export{q as Loader,E as LoaderMap,U as default,U as initLoader};
